<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
        <meta http-equiv="Pragma" content="no-cache" />
        <meta http-equiv="Expires" content="0" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        <meta name="viewport" content="initial-scale=1, maximum-scale=1">
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i&display=swap" rel="stylesheet">
        <link href="/style.css" rel="stylesheet">
        <link rel="stylesheet" href="/style.css">
        <script src="/script.js" defer></script>
        <script src="/shadows.js" defer></script>
        <meta author="text" content="Pau Maestre i Claudia Moyano (2n DAW)">
        <link rel="shortcut icon" href="" />
        <title>Gestor de bases de dades web</title>
    </head>
    <body>
        <header>
            <h1 class="titolprincipal">Gestor de base de dades web</h1>            
        </header>

        <user-login></user-login>
        <div class="container">
            <h2>Benvingut</h2>
            <h3>Crear fila</h3>

            <!-- CREAR FILA -->
            <div id="crearFilaDiv">
                <form id="userForm">

                
                    <label for="name">Name:</label>
                    <input type="text" id="name" name="name" required><br>
                
                    <label for="mail">Mail:</label>
                    <input type="text" id="mail" name="mail" required><br>
                
                    <label for="pwdHash">Password:</label>
                    <input type="text" id="pwdHash" name="pwdHash" required><br>
                

                
                    <button type="button" onclick="submitForm()">Submit</button>
                </form>
            </div>
                  
            <div id="esborrarFila">
                <h3>Esborrar fila</h3>
                <form id="deleteForm">
                    <label for="deleteID">ID:</label>
                    <input type="text" id="deleteID" name="deleteID" required><br>
                    <p>Segur/a?</p>
                    <button type="button" onclick="deleteRow()">Delete</button>
                </form>
            </div>

            <div id="editarFila">
                <h3>Editar fila</h3>
                <form id="editForm">
                    <label for="editID">ID:</label>
                    <input type="text" id="editID" name="editID" required><br>
                
                    <label for="editName">Name:</label>
                    <input type="text" id="editName" name="editName" required><br>
                
                    <label for="editMail">Mail:</label>
                    <input type="text" id="editMail" name="editMail" required><br>
                
                    <label for="editPwdHash">Password Hash:</label>
                    <input type="text" id="editPwdHash" name="editPwdHash" required><br>
                
                    <label for="editToken">Token:</label>
                    <input type="text" id="editToken" name="editToken" required><br>
                
                    <button type="button" onclick="editRow()">Edit</button>
                  </form>
            </div>
                
            <script>
            function submitForm() {
                var form = document.getElementById("userForm");
                var formData = new FormData(form);

                fetch('/submitForm', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(Object.fromEntries(formData)),
                    })
                    .then(response => response.json())
                    .then(data => {
                        alert(data.message);
                        form.reset();
                    })
                .catch(error => console.error('Error:', error));
            }

            // BORRAR FILA
            function deleteRow() {
                var deleteID = document.getElementById("deleteID").value;

                fetch('/deleteUser', {
                    method: 'POST',
                    headers: {
                    'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ ID: deleteID }),
                })
                .then(response => response.json())
                .then(data => {
                    alert(data.message);
                    document.getElementById("deleteForm").reset();
                })
                .catch(error => console.error('Error:', error));
            }

            function editRow() {
                var editID = document.getElementById("editID").value;
                var editName = document.getElementById("editName").value;
                var editMail = document.getElementById("editMail").value;
                var editPwdHash = document.getElementById("editPwdHash").value;
                var editToken = document.getElementById("editToken").value;

                fetch('/editUser', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ ID: editID, name: editName, mail: editMail, pwdHash: editPwdHash, token: editToken }),
                    })
                    .then(response => response.json())
                    .then(data => {
                        alert(data.message);
                        document.getElementById("editForm").reset();
                    })
                .catch(error => console.error('Error:', error));
            }
        </script>                
        
        <style>
            @import url('https://fonts.googleapis.com/css2?family=Lora:wght@500&display=swap');
            body{
                padding: 0;
                margin: 0;
            }

            header {
                height: 200px;
                background-image: url(./imgs/database.jpg);
                background-repeat: no-repeat;
                background-attachment: fixed;
                background-size: cover;
                display: flex;
                align-items: center;
                justify-content: center;
            }       

            header h1{
                text-align: center;
                font-size: 30px;
                color: white;
            }

            .container{
                margin: 50px;
            }

            h2{
                font-size: 24px;
                font-family: 'Lora', serif;
            }

            h3{
                font-size: 18px;
                font-family: 'Lora', serif;
                font-style: italic;
                font-weight: 200;
                color: grey;
            }

            #crearFilaDiv input[type="text"], .esborrarSection select, #modificarForm select, #nouValor{
                padding: 5px;
                margin-bottom: 5px;
                border: 1px solid rgb(23, 97, 110);
                border-radius: 50px;
            }

            #seguentButton, #esborrarButton, #modificarButton{
                transition-duration: 1s;
                cursor: pointer;
                padding: 5px;
                margin-top: 5px;
                background-color: rgb(23, 97, 110);
                border: 1px solid rgb(23, 97, 110);
                border-radius: 5px;
                color: white;
            }

            #seguentButton:hover, #esborrarButton:hover, #modificarButton:hover{
                transition-duration: 1s;
                cursor: pointer;
                background-color: rgb(176, 203, 207);
                border: 1px solid rgb(176, 203, 207);
                border-radius: 5px;
                color: black;
            }

            .modificarFilaDiv h3{
                margin-top: 50px;
            }

            #modificarForm select, .esborrarSection select{
                margin-top: 20px;
                margin-bottom: 20px;
            }

            #modificarButton, #nouValor{
                margin-top: 10px;
            }

            .esborrarFilaDiv h3{
                margin-top: 50px;
            }

            .esborrarBBDD{
                padding-bottom: 20px;
            }
        </style>

        </body>
</html>