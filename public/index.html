<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
        <meta http-equiv="Pragma" content="no-cache" />
        <meta http-equiv="Expires" content="0" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        <meta name="viewport" content="initial-scale=1, maximum-scale=1">
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i&display=swap" rel="stylesheet">
        <link href="/style.css" rel="stylesheet">
        <link rel="stylesheet" href="/style.css">
        <script src="/script.js" defer></script>
        <script src="/shadows.js" defer></script>
        <meta author="text" content="Pau Maestre i Claudia Moyano (2n DAW)">
        <link rel="shortcut icon" href="" />
        <title>Gestor de bases de dades web</title>
    </head>
    <body>
        <header>
            <h1 class="titolprincipal">Gestor de base de dades web</h1>            
        </header>

        <user-login></user-login>
        
        <select name="editar" id="editar" class="editar" onchange="gestorBBDD(this)">
            <option value="">Selecciona Opci√≥n</option>
            <option value="filas">Gestor Filas</option>
            <option value="tablas">Gestor Tablas</option>
        </select>
        <div class="container" id="contenedor">

            <!-- CREAR FILA -->
            <div id="crearFilaDiv">
            <h3>Crear fila</h3>

                <form id="userForm">
                    <label for="submitName">Name:</label>
                    <input type="text" id="submitName" name="submitName" required><br>

                    <label for="submitMail">Mail:</label>
                    <input type="text" id="submitMail" name="submitMail" required><br>
                
                    <label for="submitPassword">Password:</label>
                    <input type="password" id="submitPassword" name="submitPassword" required><br>
                    <button type="button" onclick="submitRow()">Submit</button>
                </form>
            </div>
                  
            <div id="esborrarFila">
                <h3>Esborrar fila</h3>
                <form id="deleteForm">
                    <label for="deleteID">ID:</label>
                    <input type="text" id="deleteID" name="deleteID" required><br>
                    <p>Segur/a?</p>
                    <button type="button" onclick="deleteRow()">Delete</button>
                </form>
            </div>

            <div id="editarFila">
                <h3>Editar fila</h3>
                <form id="editForm">
                    <label for="editID">ID:</label>
                    <input type="text" id="editID" name="editID" required><br>
                    
                    <label for="editName">Name:</label>
                    <input type="text" id="editName" name="editName" required><br>
                
                    <label for="editMail">Mail:</label>
                    <input type="text" id="editMail" name="editMail" required><br>
                
                    <label for="editPwdHash">Password Hash:</label> 
                    <input type="password" id="editPwdHash" name="editPwdHash" required><br>
                
                    <button type="button" onclick="clean()">Clean Fields</button>
                  </form>
            </div>
                

            <script>
            
            function submitRow() {
                var submitName = document.getElementById("submitName").value;
                var submitMail = document.getElementById("submitMail").value;
                var submitPassword = document.getElementById("submitPassword").value;

                fetch('/submitForm', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({name_sub: submitName, mail_sub: submitMail, pwdHash_sub: submitPassword}),
                    })
                    .then(response => response.json())
                    .then(data => {
                        alert(data.message);
                        document.getElementById("userForm").reset();
                    })
                .catch(error => console.error('Error:', error));
            }

            // BORRAR FILA
            function deleteRow() {
                var deleteID = document.getElementById("deleteID").value;

                fetch('/deleteUser', {
                    method: 'POST',
                    headers: {
                    'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ ID: deleteID }),
                })
                .then(response => response.json())
                .then(data => {
                    alert(data.message);
                    document.getElementById("deleteForm").reset();
                })
                .catch(error => console.error('Error:', error));
            }

            function editRow() {
                var editID = document.getElementById("editID").value;
                var editName = document.getElementById("editName").value;
                var editMail = document.getElementById("editMail").value;
                var editPwdHash = document.getElementById("editPwdHash").value;

                fetch('/editUser', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({id: editID,name: editName, mail: editMail, pwdHash: editPwdHash}),
                    })
                    .then(response => response.json())
                    .then(data => {
                        alert(data.message);
                    })
                .catch(error => console.error('Error:', error));
            }
            var form = document.getElementById("editForm");   
            document.getElementById("editID").addEventListener("input", function () {
            function enviarFormulari() {
                editRow();
            }

            var interval = 10000; // envia cada 5 segons
            var enviaInterval = setInterval(enviarFormulari, interval);

            document.getElementById("editID").addEventListener("focus", function () {
                clearInterval(enviaInterval);
            });

            document.getElementById("editID").addEventListener("blur", function () {
                enviaInterval = setInterval(enviarFormulari, interval);
            });
        });
        function clean() {
            document.getElementById("editForm").reset();
        }

        function gestorBBDD(that) {
            if (that.value == "filas") {
                document.getElementById("contenedor").style.display = "block";
            } else {
                document.getElementById("contenedor").style.display = "none";
            }
        }

        </script>                
        
        <style>
            @import url('https://fonts.googleapis.com/css2?family=Lora:wght@500&display=swap');
            body{
                padding: 0;
                margin: 0;
            }

            header {
                height: 200px;
                background-image: url(./imgs/database.jpg);
                background-repeat: no-repeat;
                background-attachment: fixed;
                background-size: cover;
                display: flex;
                align-items: center;
                justify-content: center;
            }       

            header h1{
                text-align: center;
                font-size: 30px;
                color: white;
            }

            .editar {
                display: none;
            }

            .container{
                margin: 50px;
                display: none;
            }

            h2{
                font-size: 24px;
                font-family: 'Lora', serif;
            }

            h3{
                font-size: 18px;
                font-family: 'Lora', serif;
                font-style: italic;
                font-weight: 200;
                color: grey;
            }

            #crearFilaDiv input[type="text"], .esborrarSection select, #modificarForm select, #nouValor{
                padding: 5px;
                margin-bottom: 5px;
                border: 1px solid rgb(23, 97, 110);
                border-radius: 50px;
            }

            #seguentButton, #esborrarButton, #modificarButton{
                transition-duration: 1s;
                cursor: pointer;
                padding: 5px;
                margin-top: 5px;
                background-color: rgb(23, 97, 110);
                border: 1px solid rgb(23, 97, 110);
                border-radius: 5px;
                color: white;
            }

            #seguentButton:hover, #esborrarButton:hover, #modificarButton:hover{
                transition-duration: 1s;
                cursor: pointer;
                background-color: rgb(176, 203, 207);
                border: 1px solid rgb(176, 203, 207);
                border-radius: 5px;
                color: black;
            }

            .modificarFilaDiv h3{
                margin-top: 50px;
            }

            #modificarForm select, .esborrarSection select{
                margin-top: 20px;
                margin-bottom: 20px;
            }

            #modificarButton, #nouValor{
                margin-top: 10px;
            }

            .esborrarFilaDiv h3{
                margin-top: 50px;
            }

            .esborrarBBDD{
                padding-bottom: 20px;
            }
        </style>

        </body>
</html>